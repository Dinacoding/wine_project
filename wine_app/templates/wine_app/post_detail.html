{% extends 'base.html' %} 
{% load static %} {% block title %}{{ post.title }} - Wine Project {% endblock %} 
{% block content %}
<div class="container mt-5 p-4 rounded shadow-sm">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div 
        class="wine-card post-full-detail-card position-relative borderwhite shadow-sm p-4 d-flex bg-success flex-column"
      >
        <div class="card-header-custom mb-3">
          <h2 class="wine-title text-white display-4">{{ post.title }}</h2>
          <p class="wine-name lead text-muted">{{ post.wine_name }}</p>
          <span class="vintage-badge">{{ post.vintage_year }}</span>
          <p class="text-muted mt-2">
            By <span class="author-name-detail">{{ post.author }}</span> | Published on {{ post.created_at|date:"F j, Y" }}
            {% if post.created_at != post.updated_at %} (Updated on {{ post.updated_at|date:"F j, Y" }}) {% endif %}
          </p>
        </div>

        <div class="card-content-full mb-4">{{ post.content|safe }}</div>

        <div
          class="card-actions d-flex justify-content-between align-items-center border-top pt-3 mt-auto"
        >
          <a href="{% url 'blog' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left-circle me-1"></i> Back to All Posts
          </a>

          {% if user.is_authenticated and user == post.author %}
          <div class="user-actions">
            <button
              class="btn btn-delete btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#deleteDetailModal{{ post.id }}"
              title="Delete Post"
            >
              <i class="bi bi-trash"></i> Delete
            </button>
            <button
              class="btn btn-edit btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#editPostModal{{ post.id }}"
              title="Edit Post"
            >
              <i class="bi bi-pencil"></i> Edit
            </button>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
    {% if user.is_authenticated and user == post.author %}
  <!-- Edit Post Modal for the detail page -->
  <div class="modal fade" id="editPostModal{{ post.id }}" tabindex="-1" aria-labelledby="editPostModalLabel{{ post.id }}" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editPostModalLabel{{ post.id }}">
            <i class="bi bi-pencil me-2"></i> Edit Wine Post
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form method="post" action="{% url 'edit_post' %}">
            {% csrf_token %}
            <input type="hidden" name="post_id" value="{{ post.id }}">
            <div class="mb-3">
              <label for="id_title" class="form-label">Title</label>
              <input type="text" name="title" class="form-control" id="id_title" value="{{ post.title }}" required>
            </div>
            <div class="mb-3">
              <label for="id_wine_name" class="form-label">Wine Name</label>
              <input type="text" name="wine_name" class="form-control" id="id_wine_name" value="{{ post.wine_name }}" required>
            </div>
            <div class="mb-3">
              <label for="id_vintage_year" class="form-label">Vintage Year</label>
              <input type="number" name="vintage_year" class="form-control" id="id_vintage_year" value="{{ post.vintage_year }}" required>
            </div>
            <div class="mb-3">
              <label for="id_content" class="form-label">Content</label>
              <textarea name="content" class="form-control" id="id_content" rows="5" required>{{ post.content }}</textarea> 
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-success">
                <i class="bi bi-save me-1"></i> Save Changes
              </button> 
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- Delete Post Modal for the detail page -->
  <div class="modal fade delete-modal"
       id="deleteDetailModal{{ post.id }}"
       tabindex="-1"
       aria-labelledby="deleteDetailModalLabel{{ post.id }}"
       aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteDetailModalLabel{{ post.id }}">
            <i class="bi bi-exclamation-triangle me-2"></i> Confirm Delete
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to delete the post
            <strong>"{{ post.title }}"</strong>?
          </p>
          <p class="text-muted mb-0">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <form method="post" action="{% url 'delete_post' post.slug %}" style="display: inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-confirm-delete">
              <i class="bi bi-trash me-1"></i> Delete Post
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
